# SMARM.com
Djangoフレームワークで作成したWEBアプリケーションです。
メインPCやESP32とREST APIを使用して通信を行い、データの送伝達を行っています。
また、ローカル環境だけではなく、さくらVPSを利用して，本番環境としての実装も行っています。

# WEBアプリケーション説明
## ページURL
https://jphack-smarm.com/  
## ページ毎の説明
### 1.TOPページ
起床時間のグラフを見るためのページです。
使用者のニーズに対応できるように
横軸をDAY，WEEK，MONTHの3つから選択できるようにしました。
加えて、朝起きる時間にムラがある方のために、目標時間との差を表示する機能も追加しました。

### 2.SCHEDULEページ
目覚ましを掛ける時間を設定するためのページです。
カレンダーの部分は下記のサイトを参考にさせていただきました。

Djangoでカレンダーを作るシリーズ
https://blog.narito.ninja/detail/11
github
https://github.com/naritotakizawa/django-simple-calendar

こちらの方のコードをベースにsmarmに適した形になるように書き換えています。

### 3.HOWTOページ
予定がない場合に目覚ましを起動するかや，起床方法について設定できるページです。
デバイスへのデータ転送のために送受信用のAPIを作成しています。

#### データ送受信用のAPIについて
データ送受信用のAPI
- その日のスケジュールを送信するAPI  
"https://jphack-smarm.com/api/time_data/"  
- HOWTOページの設定データを送信するAPI  
"https://jphack-smarm.com/api/how_to_options/"
- HOWTOページに設定された目覚まし用の音声ファイルのURLを送信するAPI  
"https://jphack-smarm.com/api/melody/"
- HOWTOページに設定されたエアコンに命令するための配列を送信するAPI  
"https://jphack-smarm.com/api/air_conditioner_options/"
- HOWTOページに設定されたメールアドレスに遅刻時のメール送信を行うAPI  
"https://jphack-smarm.com/api/send_out_mail/"
- HOWTOページに設定されたメールアドレスに起床時のメール送信を行うAPI  
"https://jphack-smarm.com/api/send_safe_mail/"

##### ※メールの送信に関しては、悪用の危険があるため，実際には送信しない設定にしています。本番運用する際には、SMTPサーバーを利用します。



## 構成
本サービスのデバイス構成はこちらの図のようになっています。
![構成図1](https://user-images.githubusercontent.com/73453598/98344625-dbb0b780-2056-11eb-8935-f7b26ac390a2.png)

システムの主な流れは，
1. 毎日0時頃にwebアプリケーションから時間や起床方法情報を取得。
2. 目覚まし予定があれば、目覚まし5分前にカメラをセットアップ開始(時間がかかるため)。
3. 目覚まし直前に赤外線モジュールで部屋の明かりをつける。
4. 時間になると、アラーム音とサーボモータによる目覚ましを開始。
5. カメラと圧力センサから人を監視。数秒ごとに情報を取得し、カメラと圧力センサ両方から人がいない判定が返ってくれば終了。
6．終了の際に，起きた時間をwebアプリケーションに送信。
7. 次のスケジュールがあればその時間まで待機し→2.
   なければ→1．

となっています。

### 特長
#### 1. 特長1
#### 早起きの習慣化を目指したシステム設計
本サービスは早起きの習慣化を目標に、
毎日、自動で目覚ましをセット、起動、終了を行うことができます。

#### 2. 特長2
#### アラームだけでは起きられない人のための目覚まし
本サービスが対象としている、朝起きられない人の中には、「アラームが鳴り続けても寝続ける人」も多くいると思います。
そんな方のために、アラーム以外のアプローチであなたの起床を促します。　  
　　　　　　　　　
![00116 (1)](https://user-images.githubusercontent.com/73453598/98352799-d9a02600-2061-11eb-87b3-33bf0222de31.gif)

#### 3. 特長3
#### 使いやすさと見やすさを重視したwebアプリケーション
利用者が早起きのモチベーションを維持するため，
ストレスの少ない柔軟な時間設定と、起床時間の推移が見やすくなるよう心掛けて設計しました。

### 解決出来ること
* 朝が弱い人でも起きられるようになる。
* 目覚ましをwebアプリから容易にセットでき、目覚ましのつけ忘れが減少する。
* 起きた時間をグラフで見れるため、早起きの習慣化を実感できる。

### 今後の展望
* 通信をwifiもしくはBlurtoothで行い、PCの部分をjetsonnanoやRaspberry Piに変えることでより小型化を目指し，ベッドへの組み込みを容易にする。
* アラームに音楽を設定や、テレビを大音量で流すなど、目覚ましのアプローチを増やす。
* サーモカメラを用いて独自の学習モデルを開発し用いることでカメラの人物検出の精度を向上させる。
* ログイン機能等をつけて1つのベッド毎に対応できるようにする。

### 注力したこと（こだわり等）
* すべてのデバイスをベッドに組み込めるような構成にしました。
* 私たちが所属しているロボット・知能システム学研究室の強みを活かし、カメラによる物体検出の手法には研究でも使用しているYolov4を選びました。

![detection_demo_result (2)](https://user-images.githubusercontent.com/73453598/98355081-0275ea80-2065-11eb-8d20-70f21f6649ca.gif)

* 絶対に起こすという意志の下、あえて目覚ましを止めるスイッチをどこにもつけていません。


## 開発技術
### 活用した技術
#### API・データ
* COCOデータセット

#### フレームワーク・ライブラリ・モジュール
アプリケーション関連
* Django
* PostgerSQL(githubはsqlite版をupload)
* AWS
* nginx

デバイス関連
* Darknet
* 赤外線モジュール
* 圧力センサ
* サーボモータ

言語
* Python
* JavaScript
* C++


#### デバイス
* Arduino
* jetson nano
* PC

### 独自技術
#### ハッカソンで開発した独自機能・技術
* webアプリから様々な方法で目覚ましを設定できる。
* webアプリからデバイスへのデータの送受信を自動で行ってくれる。
* AWSを用いて、ローカル環境でなくとも、目覚ましを設定できる。
* カメラによる物体検出と，ベッドの足につけた圧力センサによる荷重検出により、ベッドからでるまで止まらない目覚ましを開発した。
* 赤外線モジュールを用いて自動で部屋の電気をオンにできるようにした。
* サーボモータを用いて物理的に目覚めを促す機構を開発した。

* 特に力を入れた部分  
DBからグラフに可視化するためのデータの受け渡し部分  
smarm/wakeup/views.py  
OPTIONページの，スイッチ切り替えによる特定ボタンの無効化部分  
smarm/wakeup/templates/wakeup/howto.html  
PC部分の異なる方法、異なるデバイス、異なるデータ形式との通信部分である  
PC/connect_arduino.py  
PC/connect_jetson.py  
PC/connect_server.py  

#### 製品に取り入れた研究内容（データ・ソフトウェアなど）（※アカデミック部門の場合のみ提出必須）
Yolo v4 
